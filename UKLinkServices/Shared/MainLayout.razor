@inherits LayoutComponentBase
@inject HttpClient Http
@inject Blazored.SessionStorage.ISessionStorageService sessionStorage

<div class="page">
    <div class="sidebar">
        <NavMenu filterleftNavs="@filterleftNavs" />
    </div>
    <div class="main">
        <div class="content px-4 ">
            <UKLinkHeader></UKLinkHeader>
        </div>
        <div class="content px-4">
            <Role roleDatas="@roleDatas" RoleChange="@RoleChange"></Role>
            @Body
        </div>
        <div class="content px-4">
            <Footer></Footer>
        </div>

    </div>

</div>
@code {
    private bool collapseNavMenu = true;
    public List<LeftNavMenu> store;
    private List<LeftNavMenu> leftNavs;
    private RoleData[] roleDatas;
    [Parameter]
    public List<LeftNavMenu> filterleftNavs { get; set; }

    protected override async Task OnInitializedAsync()
    {
        leftNavs = await Http.GetFromJsonAsync<List<LeftNavMenu>>("sample-data/left-nav-menu.json");
        await sessionStorage.SetItemAsync("Role", "roleDatas");
        roleDatas = await Http.GetFromJsonAsync<RoleData[]>("sample-data/role-data.json");

        filterleftNavs = leftNavs;
    }



    void RoleChange(string selectedroleId)
    {
        if (!string.IsNullOrWhiteSpace(selectedroleId ))
        {
            if (store == null)
            {
                store = new List<LeftNavMenu>();

                for (var i = 0; i < leftNavs.Count; i++)
                {
                    var menu = leftNavs[i];
                    store.Add(new LeftNavMenu { menuName = menu.menuName, RoleId = menu.RoleId, className = menu.className, href = menu.href, MenueId = menu.MenueId });

                }
            }
            filterleftNavs.Clear();
            filterleftNavs.TrimExcess();

            for (var i = 0; i < store.Count; i++)
            {
                var menu = store[i];
                if (Array.IndexOf(menu.RoleId, Convert.ToInt32(selectedroleId)) >= 0)
                {
                    filterleftNavs.Add(new LeftNavMenu { menuName = menu.menuName, RoleId = menu.RoleId, className = menu.className, href = menu.href, MenueId = menu.MenueId });
                }

            }
            StateHasChanged();
        }
        
    }
}